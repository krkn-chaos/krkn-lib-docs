<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ocp.krkn_openshift module &mdash; Krkn Foundation Library</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/krkn-style.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=91b8ad94"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="prometheus package" href="prometheus.html" />
    <link rel="prev" title="ocp package" href="ocp.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="modules.html">
            
              <img src="_static/redhat-chaos.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                v5.0.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="elastic.html">elastic package</a></li>
<li class="toctree-l1"><a class="reference internal" href="k8s.html">k8s package</a></li>
<li class="toctree-l1"><a class="reference internal" href="models.html">models package</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="ocp.html">ocp package</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="ocp.html#submodules">Submodules</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">ocp.krkn_openshift module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ocp.krkn_openshift.KrknOpenshift"><code class="docutils literal notranslate"><span class="pre">KrknOpenshift</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="ocp.html#module-ocp">Module contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="prometheus.html">prometheus package</a></li>
<li class="toctree-l1"><a class="reference internal" href="telemetry.html">telemetry package</a></li>
<li class="toctree-l1"><a class="reference internal" href="utils.html">utils package</a></li>
<li class="toctree-l1"><a class="reference internal" href="version.html">version package</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="modules.html">Krkn Foundation Library</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="modules.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="ocp.html">ocp package</a></li>
      <li class="breadcrumb-item active">ocp.krkn_openshift module</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-ocp.krkn_openshift">
<span id="ocp-krkn-openshift-module"></span><h1>ocp.krkn_openshift module<a class="headerlink" href="#module-ocp.krkn_openshift" title="Link to this heading"></a></h1>
<dl class="py class">
<dt class="sig sig-object py" id="ocp.krkn_openshift.KrknOpenshift">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">ocp.krkn_openshift.</span></span><span class="sig-name descname"><span class="pre">KrknOpenshift</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">kubeconfig_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ocp.krkn_openshift.KrknOpenshift" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">KrknKubernetes</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="ocp.krkn_openshift.KrknOpenshift.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">kubeconfig_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ocp.krkn_openshift.KrknOpenshift.__init__" title="Link to this definition"></a></dt>
<dd><p>KrknKubernetes Constructor. Can be invoked with kubeconfig_path
or, optionally, with a kubeconfig in string
format using the keyword argument</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>kubeconfig_path</strong> – kubeconfig path</p>
</dd>
<dt class="field-even">Param<span class="colon">:</span></dt>
<dd class="field-even"><p>request_chunk_size: int of chunk size to limit requests to</p>
</dd>
</dl>
<p>Initialization with kubeconfig path:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">KrknKubernetes</span><span class="p">(</span><span class="n">log_writer</span><span class="p">,</span> <span class="s2">&quot;/home/test/.kube/config&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ocp.krkn_openshift.KrknOpenshift.collect_filter_archive_ocp_logs">
<span class="sig-name descname"><span class="pre">collect_filter_archive_ocp_logs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">src_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dst_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kubeconfig_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_timestamp</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_timestamp</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">log_filter_patterns</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threads</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">safe_logger</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">SafeLogger</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">namespace</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">oc_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="headerlink" href="#ocp.krkn_openshift.KrknOpenshift.collect_filter_archive_ocp_logs" title="Link to this definition"></a></dt>
<dd><p>Collects, filters and finally creates a tar.gz archive containing
the filtered logs matching the criteria passed as parameters.
The logs are used leveraging the oc CLI with must-gather option
(<cite>oc adm must-gather</cite>)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>src_dir</strong> – the folder containing the files to be filtered</p></li>
<li><p><strong>dst_dir</strong> – the folder where the filtered logs will be written</p></li>
<li><p><strong>kubeconfig_path</strong> – path of the kubeconfig file used by the <cite>oc</cite>
CLI to gather the log files from the cluster</p></li>
<li><p><strong>start_timestamp</strong> – timestamp of the first relevant entry, if None
will start from the beginning</p></li>
<li><p><strong>end_timestamp</strong> – timestamp of the last relevant entry, if None
will be collected until the latest</p></li>
<li><p><strong>threads</strong> – the number of threads that will do the job</p></li>
<li><p><strong>log_filter_patterns</strong> – a list of regex that will match and
extract the time info that will be parsed by dateutil.parser
(it supports several formats by default but not every date format)</p></li>
<li><p><strong>safe_logger</strong> – thread safe logger used to log
the output on a file stream</p></li>
<li><p><strong>namespace</strong> – if set the logs will refer only to the provided
namespace</p></li>
<li><p><strong>oc_path</strong> – the path of the <cite>oc</cite> CLI, if None will
be searched in the PATH</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>the path of the archive containing the filtered logs</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ocp.krkn_openshift.KrknOpenshift.filter_must_gather_ocp_log_folder">
<span class="sig-name descname"><span class="pre">filter_must_gather_ocp_log_folder</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">src_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dst_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_timestamp</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_timestamp</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">log_files_extension</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threads</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">log_filter_patterns</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ocp.krkn_openshift.KrknOpenshift.filter_must_gather_ocp_log_folder" title="Link to this definition"></a></dt>
<dd><p>Filters a folder containing logs collected by the
<cite>oc adm must-gather</cite> command
(usually logs) with a given extension.
The time info is extracted matching each line against
the patterns passed as parameters and within the time
range between <cite>start_timestamp</cite>
and <cite>end_timestamp</cite>. if start and end timestamp
are None the bottom and top time limit
will be removed respectively. The filtering is multithreaded.
The timezone of the client and the cluster will
be applied to the filter and the records.
If a file does not contain relevant rows in the
time range won’t be written in the
dst_dir
The output of the filter will be the original file name
with all the folder structure (base
folder not included) added as a prefix and
separated by a dot, eg.
src_dir: /tmp/folder
dst_dir: /tmp/filtered
log_file: /tmp/folder/namespaces/openshift-monitoring/pods/prometheus-k8s-0/logs/current.log # NOQA
output: /tmp/filtered/namespaces.openshift-monitoring.pods.prometheus-k8s-0.logs.current.log # NOQA</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>src_dir</strong> – the folder containing the files to be filtered</p></li>
<li><p><strong>dst_dir</strong> – the folder where the filtered logs will be written</p></li>
<li><p><strong>start_timestamp</strong> – timestamp of the first relevant entry, if None
will start from the beginning</p></li>
<li><p><strong>end_timestamp</strong> – timestamp of the last relevant entry, if None
will be collected until the latest</p></li>
<li><p><strong>log_files_extension</strong> – the extension of the files that will be filtered
using wildcards (* will consider all the files, log_file_name.log will consider only this file)</p></li>
<li><p><strong>threads</strong> – the number of threads that will do the job</p></li>
<li><p><strong>log_filter_patterns</strong> – a list of regex that will match and extract the time info that will be
parsed by dateutil.parser (it supports several formats by default but not every date format).
Each pattern <em>must contain</em> only 1 group that represent the time string that must be extracted
and parsed</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ocp.krkn_openshift.KrknOpenshift.get_cloud_infrastructure">
<span class="sig-name descname"><span class="pre">get_cloud_infrastructure</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="headerlink" href="#ocp.krkn_openshift.KrknOpenshift.get_cloud_infrastructure" title="Link to this definition"></a></dt>
<dd><p>Get the cluster Cloud infrastructure name when available</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>the cluster infrastructure name or <cite>Unknown</cite> when unavailable</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ocp.krkn_openshift.KrknOpenshift.get_cluster_network_plugins">
<span class="sig-name descname"><span class="pre">get_cluster_network_plugins</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#ocp.krkn_openshift.KrknOpenshift.get_cluster_network_plugins" title="Link to this definition"></a></dt>
<dd><p>Get the cluster Cloud network plugins list</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>the cluster infrastructure name or <cite>Unknown</cite> when unavailable</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ocp.krkn_openshift.KrknOpenshift.get_cluster_type">
<span class="sig-name descname"><span class="pre">get_cluster_type</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="headerlink" href="#ocp.krkn_openshift.KrknOpenshift.get_cluster_type" title="Link to this definition"></a></dt>
<dd><p>Get the cluster Cloud infrastructure type when available
status:</p>
<blockquote>
<div><dl>
<dt>platformStatus:</dt><dd><p>aws:
region: us-west-2
resourceTags:
- key: prowci</p>
<blockquote>
<div><p>value: ci-rosa-**</p>
</div></blockquote>
<ul class="simple">
<li><dl class="simple">
<dt>key: red-hat-clustertype</dt><dd><p>value: rosa</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>key: red-hat-managed</dt><dd><p>value: “true”</p>
</dd>
</dl>
</li>
</ul>
<p>type: AWS</p>
</dd>
</dl>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>the cluster type (ex. rosa) or <cite>self-managed</cite> when unavailable</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ocp.krkn_openshift.KrknOpenshift.get_clusterversion_string">
<span class="sig-name descname"><span class="pre">get_clusterversion_string</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="headerlink" href="#ocp.krkn_openshift.KrknOpenshift.get_clusterversion_string" title="Link to this definition"></a></dt>
<dd><p>Return clusterversion status text on OpenShift, empty string
on other distributions</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>clusterversion status</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ocp.krkn_openshift.KrknOpenshift.get_prometheus_api_connection_data">
<span class="sig-name descname"><span class="pre">get_prometheus_api_connection_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">namespace</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'openshift-monitoring'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">PrometheusConnectionData</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="headerlink" href="#ocp.krkn_openshift.KrknOpenshift.get_prometheus_api_connection_data" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ocp.krkn_openshift.KrknOpenshift.is_openshift">
<span class="sig-name descname"><span class="pre">is_openshift</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#ocp.krkn_openshift.KrknOpenshift.is_openshift" title="Link to this definition"></a></dt>
<dd><p>Checks if is an openshift cluster
:return: true if it’s openshift, false if not</p>
</dd></dl>

</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="ocp.html" class="btn btn-neutral float-left" title="ocp package" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="prometheus.html" class="btn btn-neutral float-right" title="prometheus package" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Red Hat Chaos Team.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>